<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name># Common</name>
    <events>
        <include># Player</include>
        <include># Interface</include>
        <include># Generation</include>
        <include># Real People</include>
        <variable constant="0" name="TURN_TIME" sid="311753241124730" static="0" type="number">0.5</variable>
        <comment>setup</comment>
        <event-block sid="546688573281992">
            <conditions>
                <condition id="3" name="All scripts loaded" sid="899972672442665" type="JS" />
                <condition id="-4" name="Trigger once while true" sid="558339466051152" type="System" />
            </conditions>
            <actions>
                <action id="6" name="Call function" sid="667982979599250" type="JS">
                    <param id="0" name="Expression">&quot;gen&quot;</param>
                    <param id="1" name="Parameter {n}">&quot;dungeon&quot;{###}2</param>
                </action>
                <action id="-36" name="Save" sid="251293215025864" type="System">
                    <param id="0" name="Slot">&quot;mysave&quot;</param>
                </action>
                <action id="-18" name="Set layer opacity" sid="739445016341197" type="System">
                    <param id="0" name="Layer">&quot;Blood&quot;</param>
                    <param id="1" name="Opacity">0</param>
                </action>
            </actions>
        </event-block>
        <comment>play music</comment>
        <event-block sid="131164295376343">
            <conditions>
                <condition id="5" inverted="1" name="Is tag playing" sid="876662543084831" type="Audio">
                    <param id="0" name="Tag">&quot;music&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="0" name="Play" sid="736352665881412" type="Audio">
                    <param id="0" name="Audio file">tempSong</param>
                    <param id="2" name="Loop">1</param>
                    <param id="3" name="Volume">-5</param>
                    <param id="1" name="Tag (optional)">&quot;music&quot;</param>
                </action>
            </actions>
        </event-block>
        <comment>doors</comment>
        <event-block sid="428402202390904">
            <conditions>
                <condition id="0" name="On key pressed" sid="919548917111936" type="Keyboard">
                    <param id="0" name="Key">69</param>
                </condition>
                <condition id="1" name="Is overlapping another object" sid="847023263757561" type="player">
                    <param id="0" name="Object">door_collider</param>
                </condition>
                <condition id="1" name="Is overlapping another object" sid="855687674732987" type="door_collider">
                    <param id="0" name="Object">Doors</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="889506070435978">
                    <conditions>
                        <condition id="2" inverted="1" name="Is playing" sid="131774949688250" type="Doors">
                            <param id="0" name="Animation">&quot;Locked&quot;</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="668296385045475">
                            <conditions>
                                <condition id="-10" name="For" sid="306539897794604" type="System">
                                    <param id="0" name="Name">&quot;layout-fade&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">20</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-16" name="Wait" sid="597552890261785" type="System">
                                    <param id="0" name="Seconds">0.01*loopindex</param>
                                </action>
                                <action id="-16" name="Set opacity" sid="171223599067236" type="blac">
                                    <param id="0" name="Opacity">blac.Opacity+5</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="819870251781793">
                            <conditions />
                            <actions>
                                <action id="-16" name="Wait" sid="632021788009463" type="System">
                                    <param id="0" name="Seconds">0.2</param>
                                </action>
                                <action id="-4" name="Set layer visible" sid="403325515178944" type="System">
                                    <param id="0" name="Layer">&quot;Loading&quot;</param>
                                    <param id="1" name="Visibility">1</param>
                                </action>
                                <action id="-25" name="Go to layout (by name)" sid="908221400841287" type="System">
                                    <param id="0" name="Layout">Function.Call(&quot;generateLayout&quot;, &quot;dungeon&quot;)</param>
                                </action>
                                <action id="0" name="Play" sid="890644756353780" type="Audio">
                                    <param id="0" name="Audio file">door</param>
                                    <param id="2" name="Loop">0</param>
                                    <param id="3" name="Volume">-10</param>
                                    <param id="1" name="Tag (optional)">&quot;door&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="377810563821670">
                    <conditions>
                        <condition id="-22" name="Else" sid="786561935119975" type="System" />
                    </conditions>
                    <actions>
                        <action id="0" name="Play" sid="984661321927359" type="Audio">
                            <param id="0" name="Audio file">locked</param>
                            <param id="2" name="Loop">0</param>
                            <param id="3" name="Volume">-10</param>
                            <param id="1" name="Tag (optional)">&quot;locked&quot;</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
        <comment>lock doors if enemies on screen</comment>
        <event-block sid="312907109712529">
            <conditions>
                <condition id="-3" name="Is on-screen" sid="942349446234108" type="PathFinding" />
            </conditions>
            <actions>
                <action id="4" name="Set animation" sid="605110399661176" type="Doors">
                    <param id="0" name="Animation">&quot;Locked&quot;</param>
                    <param id="1" name="From">1</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="326650605046982">
            <conditions>
                <condition id="-22" name="Else" sid="735950482940484" type="System" />
            </conditions>
            <actions>
                <action id="4" name="Set animation" sid="852264311630649" type="Doors">
                    <param id="0" name="Animation">&quot;Default&quot;</param>
                    <param id="1" name="From">1</param>
                </action>
            </actions>
        </event-block>
        <event-group description="" sid="918296554296439" title="Camera">
            <sub-events>
                <event-block sid="858913440476167">
                    <conditions>
                        <condition id="-4" name="Trigger once while true" sid="488073330303599" type="System" />
                    </conditions>
                    <actions>
                        <action id="-16" name="Wait" sid="855378695097128" type="System">
                            <param id="0" name="Seconds">0.0001</param>
                        </action>
                        <action id="-3" name="Create object" sid="710448210580920" type="System">
                            <param id="0" name="Object to create">camera</param>
                            <param id="1" name="Layer">&quot;Colliders&quot;</param>
                            <param id="2" name="X">player.X</param>
                            <param id="3" name="Y">player.Y</param>
                        </action>
                    </actions>
                </event-block>
                <variable constant="1" name="CAM_SPEED" sid="960753553062681" static="1" type="number">3</variable>
                <event-block sid="735387870424819">
                    <conditions />
                    <actions>
                        <action id="-3" name="Set position" sid="619504477218794" type="camera">
                            <param id="0" name="X">lerp(Self.X, player.X, CAM_SPEED*dt)</param>
                            <param id="1" name="Y">lerp(Self.Y, player.Y, CAM_SPEED*dt)</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-group>
        <event-group description="" sid="378854519229160" title="Chest">
            <sub-events>
                <event-block sid="342324836275207">
                    <conditions>
                        <condition id="-8" inverted="1" name="Is boolean instance variable set" sid="582754747729678" type="spr_chest">
                            <param id="0" name="Instance variable">empty</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="307205498081789">
                            <conditions>
                                <condition id="1" name="Is overlapping another object" sid="158264641327300" type="player">
                                    <param id="0" name="Object">spr_chest</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="4" name="Set animation" sid="278295513613728" type="spr_chest">
                                    <param id="0" name="Animation">&quot;Hover&quot;</param>
                                    <param id="1" name="From">1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="831820074011063">
                            <conditions>
                                <condition id="-22" name="Else" sid="410272170784953" type="System" />
                            </conditions>
                            <actions>
                                <action id="4" name="Set animation" sid="557935472589185" type="spr_chest">
                                    <param id="0" name="Animation">&quot;Default&quot;</param>
                                    <param id="1" name="From">1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="416928585001142">
                            <conditions>
                                <condition id="0" name="On key pressed" sid="690891807541790" type="Keyboard">
                                    <param id="0" name="Key">69</param>
                                </condition>
                                <condition id="1" name="Is overlapping another object" sid="451752273607857" type="player">
                                    <param id="0" name="Object">spr_chest</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-13" name="Set boolean" sid="757501998884701" type="spr_chest">
                                    <param id="0" name="Instance variable">empty</param>
                                    <param id="1" name="Value">1</param>
                                </action>
                                <action id="4" name="Set animation" sid="281182483749680" type="spr_chest">
                                    <param id="0" name="Animation">&quot;Open&quot;</param>
                                    <param id="1" name="From">1</param>
                                </action>
                                <action id="6" name="Call function" sid="278682696122550" type="JS">
                                    <param id="0" name="Expression">&quot;inv.addItems&quot;</param>
                                    <param id="1" name="Parameter {n}">spr_chest.loot</param>
                                </action>
                                <action id="6" name="Call function" sid="117343679550656" type="JS">
                                    <param id="0" name="Expression">&quot;inv.print&quot;</param>
                                    <param id="1" name="Parameter {n}"></param>
                                </action>
                            </actions>
                            <sub-events>
                                <event-block sid="687204586971677">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Play" sid="186233546548042" type="Audio">
                                            <param id="0" name="Audio file">lootGet1</param>
                                            <param id="2" name="Loop">0</param>
                                            <param id="3" name="Volume">10</param>
                                            <param id="1" name="Tag (optional)">&quot;loot&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
        <event-group description="" sid="818649156212513" title="Cool Stuff">
            <sub-events>
                <comment>flame sound</comment>
                <event-block sid="356992881870320">
                    <conditions>
                        <condition id="-3" name="Is on-screen" sid="289620325874406" type="flame_spr" />
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="271217295059194">
                            <conditions>
                                <condition id="-4" name="Trigger once while true" sid="179504091096227" type="System" />
                            </conditions>
                            <actions>
                                <action id="0" name="Play" sid="873121195957527" type="Audio">
                                    <param id="0" name="Audio file">fire1</param>
                                    <param id="2" name="Loop">1</param>
                                    <param id="3" name="Volume">-5</param>
                                    <param id="1" name="Tag (optional)">&quot;fire&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="116953690485964">
                    <conditions>
                        <condition id="-22" name="Else" sid="104264624084176" type="System" />
                    </conditions>
                    <actions>
                        <action id="6" name="Stop" sid="874681039355019" type="Audio">
                            <param id="0" name="Tag">&quot;fire&quot;</param>
                        </action>
                    </actions>
                </event-block>
                <comment>destroy slash when finished</comment>
                <event-block sid="281700014652823">
                    <conditions>
                        <condition id="4" name="On finished" sid="367445655079608" type="flame_spr2">
                            <param id="0" name="Animation">&quot;Default&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-16" name="Wait" sid="192939967658131" type="System">
                            <param id="0" name="Seconds">0.5</param>
                        </action>
                    </actions>
                    <sub-events>
                        <event-block sid="882652672473377">
                            <conditions>
                                <condition id="-10" name="For" sid="867935383866260" type="System">
                                    <param id="0" name="Name">&quot;&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">10</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-16" name="Wait" sid="712594908788489" type="System">
                                    <param id="0" name="Seconds">loopindex/10</param>
                                </action>
                                <action id="-16" name="Set opacity" sid="312823918334176" type="flame_spr2">
                                    <param id="0" name="Opacity">flame_spr2.Opacity - 10</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="990641577521697">
                    <conditions>
                        <condition id="-10" name="Compare opacity" sid="610098767785705" type="flame_spr2">
                            <param id="0" name="Comparison">3</param>
                            <param id="1" name="Opacity">0</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-9" name="Destroy" sid="804567586248675" type="flame_spr2" />
                    </actions>
                </event-block>
                <event-block sid="511828772950622">
                    <conditions>
                        <condition id="-18" name="On created" sid="906131750189514" type="flame_spr2" />
                    </conditions>
                    <actions>
                        <action id="0" name="Play" sid="315637256010219" type="Audio">
                            <param id="0" name="Audio file">slash</param>
                            <param id="2" name="Loop">0</param>
                            <param id="3" name="Volume">-10</param>
                            <param id="1" name="Tag (optional)">&quot;slash&quot;</param>
                        </action>
                        <action behavior="ScrollTo" id="0" name="Shake" sid="600544493652459" type="camera">
                            <param id="0" name="Magnitude">30</param>
                            <param id="1" name="Duration">0.4</param>
                            <param id="2" name="Mode">0</param>
                        </action>
                        <action id="5" name="Set playback rate" sid="311389101808802" type="Audio">
                            <param id="0" name="Tag">&quot;slash&quot;</param>
                            <param id="1" name="Playback rate">random(0.8, 1.2)</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-group>
        <event-group description="" sid="290257035324819" title="Movement">
            <sub-events>
                <variable constant="1" name="STEP" sid="708237805233729" static="0" type="number">256</variable>
                <event-block sid="363198703204125">
                    <conditions>
                        <condition id="-8" inverted="1" name="Is boolean instance variable set" sid="619656695857457" type="player">
                            <param id="0" name="Instance variable">busy</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <comment>turn based wait thing for ai moving</comment>
                        <variable constant="0" name="oldX" sid="478355633447014" static="1" type="number">0</variable>
                        <variable constant="0" name="oldY" sid="168513857626284" static="1" type="number">0</variable>
                        <event-block sid="837325001922863">
                            <conditions>
                                <condition id="0" name="On key pressed" sid="824339632121514" type="Keyboard">
                                    <param id="0" name="Key">87</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="101896154069715" type="System">
                                    <param id="0" name="Variable">oldX</param>
                                    <param id="1" name="Value">player.X</param>
                                </action>
                                <action id="-9" name="Set value" sid="962903228352194" type="System">
                                    <param id="0" name="Variable">oldY</param>
                                    <param id="1" name="Value">player.Y</param>
                                </action>
                                <action id="-2" name="Set Y" sid="570440085775567" type="player">
                                    <param id="0" name="Y">player.Y-STEP</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="855321508394455">
                            <conditions>
                                <condition id="0" name="On key pressed" sid="735446747938497" type="Keyboard">
                                    <param id="0" name="Key">65</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="996290239279165" type="System">
                                    <param id="0" name="Variable">oldX</param>
                                    <param id="1" name="Value">player.X</param>
                                </action>
                                <action id="-9" name="Set value" sid="896823729205757" type="System">
                                    <param id="0" name="Variable">oldY</param>
                                    <param id="1" name="Value">player.Y</param>
                                </action>
                                <action id="-1" name="Set X" sid="985196429644199" type="player">
                                    <param id="0" name="X">player.X-STEP</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="335044519949682">
                            <conditions>
                                <condition id="0" name="On key pressed" sid="219408353105468" type="Keyboard">
                                    <param id="0" name="Key">83</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="836695164246927" type="System">
                                    <param id="0" name="Variable">oldX</param>
                                    <param id="1" name="Value">player.X</param>
                                </action>
                                <action id="-9" name="Set value" sid="479137976688277" type="System">
                                    <param id="0" name="Variable">oldY</param>
                                    <param id="1" name="Value">player.Y</param>
                                </action>
                                <action id="-2" name="Set Y" sid="336988567379406" type="player">
                                    <param id="0" name="Y">player.Y+STEP</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="334235548478674">
                            <conditions>
                                <condition id="0" name="On key pressed" sid="551730744134376" type="Keyboard">
                                    <param id="0" name="Key">68</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="736067099650424" type="System">
                                    <param id="0" name="Variable">oldX</param>
                                    <param id="1" name="Value">player.X</param>
                                </action>
                                <action id="-9" name="Set value" sid="410376487033519" type="System">
                                    <param id="0" name="Variable">oldY</param>
                                    <param id="1" name="Value">player.Y</param>
                                </action>
                                <action id="-1" name="Set X" sid="584268014498529" type="player">
                                    <param id="0" name="X">player.X+STEP</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block any="1" sid="997321069255321">
                            <conditions>
                                <condition id="0" name="On key pressed" sid="897826770948647" type="Keyboard">
                                    <param id="0" name="Key">87</param>
                                </condition>
                                <condition id="0" name="On key pressed" sid="120433804600661" type="Keyboard">
                                    <param id="0" name="Key">65</param>
                                </condition>
                                <condition id="0" name="On key pressed" sid="527355229613894" type="Keyboard">
                                    <param id="0" name="Key">83</param>
                                </condition>
                                <condition id="0" name="On key pressed" sid="407246789654930" type="Keyboard">
                                    <param id="0" name="Key">68</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="0" name="Play" sid="323358237579830" type="Audio">
                                    <param id="0" name="Audio file">guy_moving</param>
                                    <param id="2" name="Loop">0</param>
                                    <param id="3" name="Volume">-20</param>
                                    <param id="1" name="Tag (optional)">&quot;guy&quot;</param>
                                </action>
                                <action id="5" name="Set playback rate" sid="124766861925975" type="Audio">
                                    <param id="0" name="Tag">&quot;guy&quot;</param>
                                    <param id="1" name="Playback rate">random(0.8, 1.2)</param>
                                </action>
                            </actions>
                            <sub-events>
                                <event-block sid="521908764858918">
                                    <conditions>
                                        <condition id="-3" name="Is on-screen" sid="729917971299048" type="PathFinding" />
                                    </conditions>
                                    <actions>
                                        <action id="-13" name="Set boolean" sid="862485810638981" type="player">
                                            <param id="0" name="Instance variable">busy</param>
                                            <param id="1" name="Value">1</param>
                                        </action>
                                        <action id="-16" name="Wait" sid="700865432580173" type="System">
                                            <param id="0" name="Seconds">TURN_TIME</param>
                                        </action>
                                        <action id="0" name="Call function" sid="509366121502797" type="Function">
                                            <param id="0" name="Name">&quot;ai.move&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                        <action id="-13" name="Set boolean" sid="458289111863104" type="player">
                                            <param id="0" name="Instance variable">busy</param>
                                            <param id="1" name="Value">0</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="630056197490122">
                                    <conditions>
                                        <condition id="1" name="Is overlapping another object" sid="723661938842048" type="player">
                                            <param id="0" name="Object">solid_collider</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="-3" name="Set position" sid="510387938479284" type="player">
                                            <param id="0" name="X">oldX</param>
                                            <param id="1" name="Y">oldY</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="117277048687465">
                    <conditions>
                        <condition id="1" name="On any touch end" sid="900148077711759" type="Touch" />
                    </conditions>
                    <actions />
                </event-block>
            </sub-events>
        </event-group>
    </events>
</c2eventsheet>
